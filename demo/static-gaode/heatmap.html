<!DOCTYPE html>
<html>
<head>
    <title>Heatmap</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        html, body, #map-canvas {
        margin: 0;
        padding: 0;
        height: 100%;
        }
    </style>
    <script src="http://codeorigin.jquery.com/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=7355a3808243e8691c73ae0cd082c70b&"></script>
    <!-- <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=您申请的key值"></script> -->
    <!-- <script type="text/javascript" src="https://webapi.amap.com/loca?v=1.3.2&key=7355a3808243e8691c73ae0cd082c70b"></script> -->
    <!-- <script src="//a.amap.com/Loca/static/mock/heatmapData.js"></script> -->
    <script src="common.js"></script>
    <script>
        var EPS = 0.00001;

        var map;
        var heatmap;
        var index = window.location.search.split("=")[1];

        var update = function(points) {
            var data = [];

            for (var i = 0; i < points.length; i++) {
                var count = points[i].Count ? points[i].Count : 1;

                /* var latLng = new google.maps.LatLng(points[i].Lat, points[i].Lon);
                var weightedLoc = {
                    location: latLng,
                    weight: count
                }; */
                data.push({
                    lng: points[i].Lon, 
                    lat: points[i].Lat,
                    count: count
                });
            }

           
            heatmap.setDataSet({
                data: data,
                max: 100
            });
        }

        var initMap =function(){
            var marker
            marker, map = new AMap.Map("map-canvas", {
                resizeEnable: true,
                center: [121.219958,31.096862],
                zoom: 9
            });
            return map
        }

        init(update, function(map) {
            /* heatmap = new google.maps.visualization.HeatmapLayer({
                opacity: 0.5,
                dissipating: true,
                data: [],
                dissipating: true,
                map: map,
                radius: 30
            }); */
            map.plugin(["AMap.Heatmap"], function () {
        //初始化heatmap对象
                heatmap = new AMap.Heatmap(map, {
                    radius: 55, //给定半径
                    opacity: [0.2, 0.7]
                    /*,
                    gradient:{
                        0.5: 'blue',
                        0.65: 'rgb(117,211,248)',
                        0.7: 'rgb(0, 255, 0)',
                        0.9: '#ffea00',
                        1.0: 'red'
                    }
                    */
                });
            });
        },
        initMap);
    </script>
</head>
<body>
<div id="map-canvas"></div>
</body>
</html>